<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trainer Dashboard - Gym Management</title>
<link rel="stylesheet" href="css/style.css" />
<script defer src="js/trainer.js"></script>
<script defer src="js/chat.js"></script>
<script defer src="js/calendar.js"></script> <!-- hypothetical calendar lib -->
</head>
<body>
<header>
  <h1>Welcome, Trainer <span id="trainerName">John Smith</span></h1>
  <nav>
    <ul>
      <li><a href="#assignedMembersSection">Assigned Members</a></li>
      <li><a href="#sessionsSection">Scheduled Sessions</a></li>
      <li><a href="#routinesSection">Workout Routines</a></li>
      <li><a href="#progressReportsSection">Progress Reports</a></li>
      <li><a href="#availabilitySection">Set Availability</a></li>
      <li><a href="#messagesSection">Messages</a></li>
    </ul>
  </nav>
</header>

<main>
  <section id="assignedMembersSection">
    <h2>Your Members</h2>
    <ul id="assignedMembersList"></ul>
  </section>

  <section id="sessionsSection">
    <h2>Upcoming Sessions</h2>
    <div id="sessionCalendar"></div>
    <button onclick="openScheduleSessionModal()">Schedule New Session</button>
    <ul id="sessionsList"></ul>
  </section>

  <section id="routinesSection">
    <h2>Workout Routines</h2>
    <button onclick="openCreateRoutineModal()">Create New Routine</button>
    <ul id="routinesList"></ul>
  </section>

  <section id="progressReportsSection">
    <h2>Member Progress Reports</h2>
    <select id="memberSelect" onchange="loadProgressReports()">
      <option value="">Select Member</option>
    </select>
    <div id="progressReports"></div>
  </section>

  <section id="availabilitySection">
    <h2>Your Availability</h2>
    <button onclick="openAvailabilityModal()">Edit Availability</button>
    <div id="availabilityDisplay"></div>
  </section>

  <section id="messagesSection">
    <h2>Messages</h2>
    <div id="chatWindow"></div>
    <textarea id="chatInput" placeholder="Write a message..."></textarea>
    <button onclick="sendMessage()">Send</button>
  </section>
</main>

<footer>
  <p>Â© 2025 Gym Management System</p>
</footer>

<script>
  // Example placeholder implementations for UI bindings

  async function loadAssignedMembers(trainerId) {
    const members = await getAssignedMembers(trainerId);
    const list = document.getElementById('assignedMembersList');
    list.innerHTML = '';
    members.forEach(m => {
      const li = document.createElement('li');
      li.textContent = m.name || m.email || m.id;
      list.appendChild(li);
      const option = new Option(m.name || m.email, m.id);
      document.getElementById('memberSelect').appendChild(option);
    });
  }

  async function loadSessions(trainerId) {
    const sessions = await getScheduledSessions(trainerId, new Date().toISOString(), new Date(Date.now() + 604800000).toISOString());
    const list = document.getElementById('sessionsList');
    list.innerHTML = '';
    sessions.forEach(s => {
      const li = document.createElement('li');
      li.textContent = `${s.sessionType} with Member ${s.memberId} on ${new Date(s.datetime).toLocaleString()}`;
      list.appendChild(li);
    });
    // Initialize calendar UI with sessions data if desired
  }

  async function loadRoutines(trainerId) {
    // Fetch and render routines created by trainer for members
  }

  async function loadProgressReports() {
    const memberId = document.getElementById('memberSelect').value;
    if (!memberId) {
      document.getElementById('progressReports').innerHTML = '';
      return;
    }
    const reports = await getMemberProgressReports(memberId);
    let html = '<ul>';
    reports.forEach(r => {
      html += `<li>${r.date}: Weight ${r.weightKg || 'N/A'}kg, BMI ${r.bmi || 'N/A'}</li>`;
    });
    html += '</ul>';
    document.getElementById('progressReports').innerHTML = html;
  }

  async function loadAvailability(trainerId) {
    const docRef = await doc(db, "trainers", trainerId);
    // Fetch availability and display in #availabilityDisplay
  }

  function openScheduleSessionModal() {
    alert('Open modal for scheduling session');
    // Implement modal UI for scheduling
  }

  function openCreateRoutineModal() {
    alert('Open modal to create workout routine');
  }

  function openAvailabilityModal() {
    alert('Open modal for managing availability');
  }

  function sendMessage() {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    if (msg) {
      alert('Sending message: ' + msg);
      input.value = '';
      // Implement actual message sending
    }
  }

  // Initialize page data for example trainerId
  const trainerId = 'trainer_sample_id123';
  loadAssignedMembers(trainerId);
  loadSessions(trainerId);
  loadAvailability(trainerId);
</script>

</body>
</html>
